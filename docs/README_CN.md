# n8n TTtrigger

n8n TTtrigger 是一款强大的 Chrome 扩展程序，它将侧边栏聊天界面直接集成到您的浏览器中。它架起了您的网页浏览、大型语言模型 (LLM) 和 n8n 自动化工作流之间的桥梁，实现了无缝的上下文感知交互。

## 功能特性

- **侧边栏界面**：一个非侵入式、可折叠的侧边栏，适用于任何网页。
- **多 LLM 支持**：配置并在多个 LLM 提供商之间切换：
  - OpenAI
  - OpenRouter
  - GLM (ZhipuAI)
- **n8n 集成**：直接从浏览器触发 n8n 工作流。
  - 发送用户输入、选中文本和页面上下文到您的 n8n webhook。
  - 支持基本身份验证和自定义请求头。
  - 直接在聊天中渲染 n8n 响应（文本、JSON 或图片）。
- **上下文感知**：
  - **选中内容**：即时就页面上选中的文本进行聊天或处理。
  - **全页上下文**：可选择在您的提示词或工作流中包含当前网页的全文。
- **生产力工具**：
  - **右键菜单**：快速执行“打开聊天”、“与选中内容聊天”或“发送选中内容到 n8n”。
  - **Markdown 渲染**：为 AI 和 n8n 响应提供富文本格式。
  - **历史记录**：聊天记录保留在本地（直到被清除）。

## 安装指南

1. 克隆或下载此仓库到您的本地机器。
2. 打开 Google Chrome 并导航至 `chrome://extensions/`。
3. 在右上角启用 **开发者模式**。
4. 点击 **加载已解压的扩展程序**。
5. 选择您下载/克隆此项目所在的目录 (`n8n Trigger`)。

## 配置说明

安装完成后，点击扩展图标并选择“设置”（齿轮）图标，或右键点击扩展图标并选择 **选项**。

### 1. LLM 提供商

配置您的 AI 模型提供商：
- **名称**：显示名称（例如，“My OpenAI”）。
- **类型**：选择 `openai`、`openrouter` 或 `glm`。
- **API Key**：提供商提供的 API 密钥。
- **Base URL**：（可选）如果您使用代理或兼容服务，请填写自定义端点 URL。

### 2. n8n Webhook

设置与您的 n8n 工作流的连接：
- **名称**：工作流的显示名称。
- **Webhook URL**：您的 n8n Webhook 节点的完整 URL（使用 `POST` 方法）。
- **输入字段**：（可选）您的工作流预期的特定字段名称（默认为 `text`、`chatInput`、`message`）。
- **认证**：（可选）如果您的 webhook 受 Basic Auth 保护，请提供用户名和密码。

### 3. 默认设置

- **默认模型**：设置全局默认模型名称（例如 `gpt-4o`、`glm-4`）。

## 使用说明

### 基础聊天

1. 点击扩展图标或使用右键菜单打开侧边栏。
2. 从下拉菜单中选择您的 LLM 提供商。
3. 输入您的消息并按回车键。

### 使用上下文

- **选中文本**：在任何网页上高亮选中文本。它将出现在聊天输入框上方的“选中预览”区域。发送消息时将包含此文本作为上下文。
- **页面上下文**：切换“引用页面”图标（文档图标），以在您的消息中包含整个页面的文本内容。

### 触发 n8n 工作流

1. 在侧边栏中，勾选 **n8n** 开关（或从下拉菜单中选择一个 n8n 工作流）。
2. 输入您的内容或在页面上选中文本。
3. 点击发送。扩展程序将向您的 n8n webhook 发送一个包含以下内容的 JSON 负载：
   - `input`：您输入的消息。
   - `selection`：当前选中的文本。
   - `context`：全页文本（如果已启用）。
   - `page`：当前页面的 URL 和标题。
   - `history`：最近的聊天对话。

## 隐私与安全

- **本地存储**：API 密钥和配置存储在您浏览器的本地存储 (`chrome.storage.local`) 中。这确保了您的敏感数据永远不会离开您的设备，也不会通过您的 Google 账户跨设备同步，严格遵守密钥“零云端化”的策略。
- **数据传输**：数据仅发送到您配置的 API 端点（LLM 提供商或您自己的 n8n 实例）。
- **权限**：该扩展程序需要访问“所有网址”的权限，以便注入侧边栏并读取页面内容以实现上下文功能。

## 开发指南

- **Manifest V3**：基于最新的 Chrome 扩展标准构建。
- **技术栈**：原生 JavaScript、HTML、CSS（无需构建步骤）。
- **项目结构**：
  - `panel.html/js/css`：主侧边栏界面。
  - `contentScript.js`：处理 iframe 注入和页面交互。
  - `background.js`：管理上下文菜单和扩展事件。
  - `options.html/js`：配置页面。

## 许可证

[MIT License](LICENSE)
