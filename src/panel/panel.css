:root {
  --bg-color: #0d1117; /* GitHub Dark Dimmed style background */
  --glass-bg: rgba(22, 27, 34, 0.7);
  --glass-border: rgba(255, 255, 255, 0.1);
  --text-primary: #e6edf3;
  --text-secondary: #7d8590;
  --accent-color: #2f81f7; /* Apple/GitHub Blue */
  --accent-hover: #58a6ff;
  --danger-color: #f85149;
  --bubble-user: #1f6feb;
  --bubble-assistant: #21262d;
  --input-bg: #161b22;
  --radius-lg: 16px;
  --radius-md: 12px;
  --radius-sm: 8px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  background-color: var(--bg-color);
  color: var(--text-primary);
  font-family: var(--font-family);
  font-size: 14px;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  min-width: 375px; /* Minimum width to prevent overlapping */
}

.panel {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 48px;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}

/* Main Area */
.main {
  grid-column: 1;
  min-width: 0; /* Allow shrinking below content size */
  display: flex;
  flex-direction: column;
  position: relative;
  background: var(--bg-color);
  padding-top: 0;
  height: 100vh; /* Full height */
  overflow: hidden; /* Prevent body scroll */
}

/* Hero Section */
.hero {
  padding: 32px 20px;
  text-align: left;
  animation: fadeIn 0.5s ease-out;
}

.hero-title {
  font-size: 28px;
  font-weight: 700;
  background: linear-gradient(135deg, #fff 0%, #7d8590 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 4px;
}

.hero-sub {
  font-size: 15px;
  color: var(--text-secondary);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Config Bar (Replaces Toolbar) */
.config-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(22, 27, 34, 0.8); /* Darker, blending with bg */
  border-bottom: 1px solid var(--glass-border); /* Separator line */
  padding: 10px 16px; /* More breathing room */
  margin-bottom: 0; /* Remove bottom margin to sit flush with messages area if needed, or keep for spacing */
  backdrop-filter: blur(12px);
  width: 100%;
  min-width: 0;
  border-radius: 0; /* Full width bar style */
}

/* Adjust main area padding to account for fixed config bar if we move it? 
   Currently it's in .composer. Let's keep it rounded and floating if that's the style.
   The user wants "comfortable display".
   Let's stick to the floating pill style but make it nicer.
*/
.config-bar {
  background: rgba(33, 38, 45, 0.6);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 6px 8px; /* Compact but comfortable */
  margin-bottom: 12px;
}

.config-left {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  min-width: 0;
  margin-right: 12px;
}

.provider-badge {
  position: relative;
  font-weight: 500;
  font-size: 13px;
  color: #fff;
  background: var(--accent-color); /* Solid blue for primary badge look or see through */
  background: rgba(47, 129, 247, 0.2);
  color: var(--accent-color);
  padding: 4px 10px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.2s;
  height: 28px;
  max-width: 120px; /* Limit width */
  overflow: hidden;
}

.provider-badge:hover {
  background: rgba(47, 129, 247, 0.3);
}

#providerLabel {
  pointer-events: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
}

#providerSelect {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

#modelInput {
  background: transparent;
  border: none;
  color: var(--text-secondary); /* Subtler text for model name */
  font-size: 13px;
  width: 100%;
  padding: 0 4px;
  outline: none;
  font-family: inherit;
  transition: color 0.2s;
}

#modelInput:focus, #modelInput:not(:placeholder-shown) {
  color: var(--text-primary);
}

#modelInput::placeholder {
  color: var(--text-secondary);
  opacity: 0.7;
}

/* Config Right */
.config-right {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
  min-width: 0;
}

.n8n-group {
  display: flex;
  align-items: center;
  gap: 0;
  min-width: 0;
  background: rgba(33, 38, 45, 0.5);
  border-radius: 6px;
  overflow: hidden;
  margin-left: 8px;
  border: 1px solid var(--glass-border);
}

.n8n-label {
  border-radius: 0;
  height: 28px;
  padding: 0 8px;
  font-size: 12px;
}

.webhook-selector {
  position: relative;
  min-width: 60px;
  max-width: 200px; /* Increased max-width */
  display: flex;
  align-items: center;
  padding: 0 8px;
  height: 28px;
}

.webhook-selector span {
  font-size: 13px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
  width: 100%;
  display: block;
  transition: color 0.2s;
}

.webhook-selector.active span {
  color: var(--accent-color);
  font-weight: 500;
}

.webhook-selector span:hover {
  color: var(--text-primary);
}

.webhook-selector select {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

.divider-vertical {
  width: 1px;
  height: 16px;
  background: var(--glass-border);
  margin: 0 4px;
}

.tool-actions {
  display: flex;
  align-items: center;
  gap: 6px;
}

.tool-item {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
}

.tool-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.2s;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.05); /* Subtle button background */
}

.tool-icon:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

input[type="checkbox"]:checked + .tool-icon {
  color: var(--accent-color);
  background: rgba(47, 129, 247, 0.2);
}

/* N8N Badge specific styles if needed */
.n8n-badge {
  /* Using same style as provider-badge for consistency */
  max-width: 120px; /* Limit width if names are long */
  overflow: hidden;
}

.n8n-badge span {
  overflow: hidden;
  text-overflow: ellipsis;
}

/* N8N Select Overlay */
#webhookSelect {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
  z-index: 10;
}

/* Image Modal */
.image-modal {
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0;
  top: 0;
  width: 100%; 
  height: 100%; 
  overflow: hidden; 
  background-color: rgba(0,0,0,0.9); 
  align-items: center;
  justify-content: center;
}

.image-modal-content {
  margin: auto;
  display: block;
  max-width: 95%;
  max-height: 95%;
  object-fit: contain;
  animation: zoomIn 0.3s;
}

.image-modal-close {
  position: absolute;
  top: 20px;
  right: 30px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  transition: 0.3s;
  cursor: pointer;
  z-index: 1001;
  line-height: 1;
  background: rgba(0, 0, 0, 0.5);
  width: 40px;
  height: 40px;
  text-align: center;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.image-modal-close:hover,
.image-modal-close:focus {
  color: #fff;
  background: rgba(255, 255, 255, 0.2);
  text-decoration: none;
  cursor: pointer;
}

@keyframes zoomIn {
  from {transform:scale(0.8); opacity: 0;} 
  to {transform:scale(1); opacity: 1;}
}

/* Chat Images */
.bubble img {
  max-width: 100%;
  cursor: zoom-in;
  border-radius: 8px;
  transition: transform 0.2s;
  display: block;
  margin: 8px 0;
}

.bubble img:hover {
  opacity: 0.95;
}

/* Tooltip Styles */
.tool-icon[data-tooltip]:hover::after,
.side-btn[data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  /* Adjust positioning for side buttons vs top tools if needed */
  /* Default to bottom/left relative to element */
}

/* Specific positioning for tool-icon (top bar) */
.tool-icon[data-tooltip]:hover::after {
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 8px;
}

/* Specific positioning for side-btn (right sidebar) */
.side-btn[data-tooltip]:hover::after {
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: 8px;
  /* Reset left/bottom from shared rule if any */
  left: auto;
  bottom: auto;
}

/* Shared tooltip visual styles */
.tool-icon[data-tooltip]:hover::after,
.side-btn[data-tooltip]:hover::after {
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.9);
  color: #fff;
  font-size: 11px;
  border-radius: 4px;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  animation: tooltipFadeIn 0.2s ease-out forwards;
  z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  border: 1px solid var(--glass-border);
}

@keyframes tooltipFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.divider {
  width: 1px;
  height: 16px;
  background: var(--glass-border);
  margin: 0 4px;
}


/* Messages */
.messages {
  flex: 1 1 auto; /* Allow grow and shrink */
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  scroll-behavior: smooth;
  min-height: 0; /* Important for flex child scrolling */
}

.messages::-webkit-scrollbar {
  width: 6px;
}
.messages::-webkit-scrollbar-track {
  background: transparent;
}
.messages::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
}

.msg {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-width: 85%;
  animation: slideUp 0.3s ease-out;
}

.msg.assistant {
  align-self: flex-start;
}

.msg:not(.assistant) { /* User messages */
  align-self: flex-end;
  align-items: flex-end;
}

.msg .role {
  font-size: 11px;
  color: var(--text-secondary);
  margin-left: 4px;
  display: none; /* Cleaner look */
}

.msg .bubble {
  padding: 10px 14px;
  border-radius: var(--radius-lg);
  font-size: 14px;
  line-height: 1.6;
  position: relative;
  overflow-wrap: break-word;
  word-break: break-word;
}

.msg.assistant .bubble {
  background: var(--bubble-assistant);
  color: var(--text-primary);
  border-bottom-left-radius: 4px;
  border: 1px solid var(--glass-border);
}

.msg:not(.assistant) .bubble {
  background: var(--bubble-user);
  color: #fff;
  border-bottom-right-radius: 4px;
  box-shadow: var(--shadow-sm);
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Message Actions */
.msg-actions {
  display: flex;
  justify-content: flex-start; /* Align left for better reading flow */
  margin-top: 4px;
  opacity: 1; /* Always visible */
  height: auto;
  overflow: visible;
  padding: 0 4px;
  gap: 4px; /* Space between buttons */
}

.msg.assistant .msg-actions {
  justify-content: flex-start;
}

.msg:not(.assistant) .msg-actions {
  justify-content: flex-end;
}

.msg-action-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  font-size: 12px;
  gap: 4px;
}

.msg-action-btn:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
}

.msg-action-btn.copied {
  color: var(--accent-color);
}

/* Composer */
.composer {
  flex-shrink: 0; /* Prevent shrinking */
  padding: 12px 20px 20px;
  background: var(--bg-color); /* Opaque background to cover messages */
  border-top: 1px solid var(--glass-border);
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 10;
}

/* Selection Preview */
.selection-preview {
  display: flex;
  align-items: flex-start; /* Align items to top for multi-line text */
  justify-content: space-between;
  background: rgba(33, 38, 45, 0.8);
  border: 1px solid var(--glass-border);
  border-radius: 8px;
  padding: 8px 12px;
  margin-bottom: 12px;
  animation: slideUp 0.2s ease-out;
  backdrop-filter: blur(8px);
  width: 100%;
  min-width: 0;
}

.selection-text {
  font-size: 12px;
  color: var(--text-primary);
  white-space: pre-wrap; /* Allow wrapping */
  word-break: break-word; /* Break long words */
  overflow-wrap: break-word;
  flex: 1;
  min-width: 0;
  position: relative;
  padding-left: 18px;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 5;
  line-clamp: 5;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.selection-text::before {
  content: "";
  position: absolute;
  left: 0;
  top: 3px; /* Align with first line of text */
  width: 12px;
  height: 12px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%237d8590' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'/%3E%3Cpolyline points='7 10 12 15 17 10'/%3E%3Cline x1='12' y1='15' x2='12' y2='3'/%3E%3C/svg%3E");
  background-size: contain;
  background-repeat: no-repeat;
  opacity: 0.7;
}

.selection-close {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
  margin-left: 8px;
}

.selection-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

/* Input Area */
.input-area {
  position: relative;
  display: flex;
  align-items: flex-end;
  gap: 8px;
}

textarea#input {
  flex: 1;
  min-height: 80px;
  background: var(--input-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  padding: 12px;
  color: var(--text-primary);
  font-family: inherit;
  resize: none;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
}

textarea#input:focus {
  border-color: var(--text-secondary);
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.2), 0 0 0 1px rgba(125,133,144,0.1);
}

textarea#input::placeholder {
  color: #484f58;
}

button#send {
  background: var(--accent-color);
  color: white;
  border: none;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
  flex-shrink: 0;
  margin-bottom: 2px;
  box-shadow: var(--shadow-sm);
}

button#send:hover {
  background: var(--accent-hover);
  transform: scale(1.05);
}

button#send:active {
  transform: scale(0.95);
}

button#send svg {
  width: 18px;
  height: 18px;
  margin-left: 2px;
}

/* Side Bar */
.side {
  grid-column: 2;
  width: 100%;
  position: relative; /* Ensure z-index works */
  background: rgba(13, 17, 23, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-left: 1px solid var(--glass-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px 0;
  gap: 8px;
  z-index: 20;
}

.spacer {
  flex: 1;
}

.side-btn {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  position: relative;
}

.side-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

/* Tooltip for side buttons */
.side-btn[aria-label]:hover::after {
  content: attr(aria-label);
  position: absolute;
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: 10px;
  background: #21262d;
  color: #e6edf3;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  border: 1px solid var(--glass-border);
  z-index: 100;
  opacity: 0;
  animation: fadeInTooltip 0.2s forwards;
}

@keyframes fadeInTooltip {
  from { opacity: 0; transform: translate(5px, -50%); }
  to { opacity: 1; transform: translate(0, -50%); }
}

/* Responsive adjustments */
@media (max-width: 400px) {
  .hero-title { font-size: 24px; }
  .config-row { flex-direction: column; }
}

/* Markdown Styles */
.markdown-body {
  font-size: 14px;
  line-height: 1.6;
}

.markdown-body p {
  margin-bottom: 10px;
}
.markdown-body p:last-child {
  margin-bottom: 0;
}

.markdown-body img {
  max-width: 100%;
  border-radius: 8px;
  margin: 8px 0;
  display: block;
}

.markdown-body table {
  border-collapse: collapse;
  width: 100%;
  margin: 8px 0;
  font-size: 13px;
}

.markdown-body th, .markdown-body td {
  border: 1px solid var(--glass-border);
  padding: 6px 10px;
  text-align: left;
}

.markdown-body th {
  background: rgba(255, 255, 255, 0.05);
  font-weight: 600;
}

.markdown-body pre {
  background: rgba(0, 0, 0, 0.3);
  padding: 10px;
  border-radius: 6px;
  overflow-x: auto;
  margin: 8px 0;
}

.markdown-body code {
  font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
  font-size: 12px;
  background: rgba(255, 255, 255, 0.1);
  padding: 2px 4px;
  border-radius: 4px;
}

.markdown-body pre code {
  background: transparent;
  padding: 0;
  color: #e6edf3;
}

.markdown-body blockquote {
  border-left: 3px solid var(--accent-color);
  margin: 8px 0;
  padding-left: 12px;
  color: var(--text-secondary);
}

.markdown-body ul, .markdown-body ol {
  padding-left: 20px;
  margin: 8px 0;
}

.markdown-body a {
  color: var(--accent-color);
  text-decoration: none;
}
.markdown-body a:hover {
  text-decoration: underline;
}

/* Loading Animation */
.loading-dots {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 8px 4px;
  min-width: 40px;
}

.loading-dots span {
  width: 6px;
  height: 6px;
  background-color: var(--text-secondary);
  border-radius: 50%;
  animation: bounce 1.4s infinite ease-in-out both;
}

.loading-dots span:nth-child(1) {
  animation-delay: -0.32s;
}

.loading-dots span:nth-child(2) {
  animation-delay: -0.16s;
}

@keyframes bounce {
  0%, 80%, 100% { 
    transform: scale(0);
    opacity: 0.5;
  }
  40% { 
    transform: scale(1);
    opacity: 1;
  }
}

/* History View */
.history-main {
  grid-column: 1;
  min-width: 0; /* Allow shrinking below content size */
  display: flex;
  flex-direction: column;
  position: relative;
  background: var(--bg-color);
  padding: 0;
  overflow: hidden;
}

.history-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--glass-border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header-btn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 6px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  width: 32px;
  height: 32px;
}

.header-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

.header-spacer {
  width: 32px;
}

.history-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

.history-list {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

.history-item {
  padding: 12px;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background 0.2s;
  margin-bottom: 4px;
  border: 1px solid transparent;
}

.history-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--glass-border);
}

.history-item-title {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.history-item-date {
  font-size: 12px;
  color: var(--text-secondary);
}

.history-empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.history-item-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.btn-delete-history {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  display: none; /* Show on hover */
}

.history-item:hover .btn-delete-history {
  display: block;
}

.btn-delete-history:hover {
  color: var(--danger-color);
  background: rgba(248, 81, 73, 0.1);
}